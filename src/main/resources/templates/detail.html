<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <title th:text="${post.title}">글 상세</title>
    <style>
        body { max-width: 900px; margin: 2rem auto; font-family: 'Segoe UI', sans-serif; background: #fafafa; padding: 1rem; line-height: 1.6; }
        h1, h2 { color: #222; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .post-meta { font-size: 0.9rem; color: #666; margin-bottom: 1rem; }
        .post-content { white-space: pre-line; margin-bottom: 2rem; }
        .attachments { margin: 2rem 0; }
        .attachments img, .attachments video { display: block; margin: 1rem 0; max-width: 100%; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .comments-list { list-style: none; padding-left: 0; }
        .comments-list li { background: white; padding: 1rem; border-radius: 5px; margin-bottom: 1rem; }
    </style>
</head>
<body>

<article>
    <header>
        <h1 th:text="${post.title}">제목</h1>
        <div class="post-meta">
            작성자: <strong th:text="${post.user.email}">작성자</strong> |
            <time th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</time> |
            조회수: <span th:text="${post.views}">0</span> |
            ❤️ <span th:text="${likeCount}">0</span>
        </div>
    </header>

    <section class="post-content" th:text="${post.content}">내용</section>

    <!-- ✅ 첨부파일 -->
    <section class="attachments" th:if="${!#lists.isEmpty(post.files)}">
        <h3>첨부파일</h3>
        <div th:each="file : ${post.files}">

            <!-- 이미지 파일 -->
            <img th:if="${#strings.endsWith(file.fileName, '.jpg')
                         or #strings.endsWith(file.fileName, '.jpeg')
                         or #strings.endsWith(file.fileName, '.png')
                         or #strings.endsWith(file.fileName, '.gif')}"
                 th:src="@{${file.fileUrl}}" alt="첨부 이미지"/>

            <!-- 동영상 파일 -->
            <video th:if="${#strings.endsWith(file.fileName, '.mp4')
                           or #strings.endsWith(file.fileName, '.webm')
                           or #strings.endsWith(file.fileName, '.ogg')}"
                   controls>
                <source th:src="@{${file.fileUrl}}" type="video/mp4"/>
                브라우저가 동영상을 지원하지 않습니다.
            </video>

            <!-- 기타 파일 다운로드 -->
            <a th:if="${!(#strings.endsWith(file.fileName, '.jpg')
                          or #strings.endsWith(file.fileName, '.jpeg')
                          or #strings.endsWith(file.fileName, '.png')
                          or #strings.endsWith(file.fileName, '.gif')
                          or #strings.endsWith(file.fileName, '.mp4')
                          or #strings.endsWith(file.fileName, '.webm')
                          or #strings.endsWith(file.fileName, '.ogg'))}"
               th:href="@{${file.fileUrl}}" th:text="${file.fileName}" target="_blank"></a>
        </div>
    </section>

    <nav>
        <a th:href="@{/posts}">목록으로</a>
        <a th:href="@{'/posts/' + ${post.id} + '/edit'}">수정</a>
        <form th:action="@{'/posts/' + ${post.id}}" method="post" style="display:inline;">
            <input type="hidden" name="_method" value="delete"/>
            <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
        </form>
    </nav>
</article>

<hr/>

<!-- ✅ 댓글 -->
<section>
    <h2>댓글</h2>
    <ul class="comments-list" th:each="comment : ${post.comments}">
        <li>
            <p><strong th:text="${comment.user.email}">작성자</strong></p>
            <p th:text="${comment.content}">댓글 내용</p>
            <time th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></time>
        </li>
    </ul>
</section>

<!-- ✅ 댓글 작성 -->
<form th:if="${#authorization.expression('isAuthenticated()')}" th:action="@{/comments}" method="post">
    <input type="hidden" name="postId" th:value="${post.id}"/>
    <textarea name="content" required></textarea>
    <button type="submit">댓글 등록</button>
</form>

</body>
</html>
